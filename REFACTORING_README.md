# Проект реорганизован - новая структура

## Обзор изменений

Проект был полностью реорганизован из одного огромного файла `main.go` (5272 строки) в структурированное приложение с разделением на модули.

## Новая структура проекта

```
/Users/htb300/THEGREATRANDOMIZER/THEGREATRANDOMIZER/
├── main.go                 # Главная точка входа (теперь всего ~50 строк)
├── internal/
│   ├── models/            # Модели данных
│   │   └── models.go      # Структуры данных (Bet, InventoryItem, etc.)
│   ├── config/            # Конфигурация и константы
│   │   ├── config.go      # Основная конфигурация (участники, призы)
│   │   └── quotes.go      # Цитаты для различных команд
│   ├── storage/           # Работа с Redis
│   │   └── redis.go       # Все операции с Redis (баланс, инвентарь, etc.)
│   ├── game/              # Логика игры
│   │   └── game.go        # Управление игрой, раундами, ставками
│   ├── bot/               # Telegram бот
│   │   └── handlers.go    # Обработчики команд бота
│   └── utils/             # Утилитарные функции
│       └── utils.go       # Вспомогательные функции (форматирование, etc.)
├── gamble/                # Существующий пакет для вероятностей
└── main_old.go           # Резервная копия оригинального main.go
```

## Преимущества новой структуры

1. **Модульность**: Каждый аспект приложения вынесен в отдельный пакет
2. **Читаемость**: Легко найти нужный код по его назначению
3. **Поддерживаемость**: Изменения в одном модуле не затрагивают другие
4. **Тестируемость**: Каждый пакет можно тестировать независимо
5. **Масштабируемость**: Легко добавлять новые функции в соответствующие пакеты

## Описание пакетов

### internal/models
Содержит определения структур данных:
- `Bet` - ставки игроков
- `InventoryItem` - элементы инвентаря
- `GameState` - состояние игры
- `BettingState` - состояние ставок

### internal/config
Конфигурационные данные и константы:
- Список участников и их ID
- Призы и их конфигурация
- Цитаты для различных команд
- Глобальные переменные

### internal/storage
Все операции с Redis:
- Управление балансами игроков
- Работа с инвентарем
- Сохранение/загрузка штрафов
- Управление плашками

### internal/game
Логика игрового процесса:
- Управление состоянием игры
- Выбор победителей раундов
- Выплаты по ставкам
- Удаление участников

### internal/bot
Обработчики команд Telegram бота:
- `/start`, `/help` - базовые команды
- `/balance`, `/shop`, `/inv` - экономика
- `/rob`, `/platerob` - активности
- Админские команды

### internal/utils
Вспомогательные функции:
- Форматирование имен и текста
- Генерация хэшей
- Преобразование данных

## Как запустить

```bash
# Установка зависимостей
go mod tidy

# Сборка
go build -o tg-random-bot .

# Запуск (требуются переменные окружения)
export TELEGRAM_BOT_TOKEN="your_bot_token"
export REDIS_ADDR="localhost:6379"  # опционально
export REDIS_PASSWORD=""            # опционально
./tg-random-bot
```

## Статус миграции

✅ **Завершено:**
- Создание пакетов и их структуры
- Перенос моделей данных
- Извлечение конфигурации и констант
- Реализация Redis операций
- Создание игровой логики
- Разработка обработчиков бота
- Написание утилитарных функций
- Рефакторинг main.go

⏳ **Требует доработки:**
- Полная реализация всех команд бота
- Тестирование интеграции
- Проверка работы всех функций

## Следующие шаги

1. **Тестирование**: Запустить приложение и проверить основные функции
2. **Дополнение**: Реализовать недостающую логику команд
3. **Оптимизация**: Улучшить производительность и обработку ошибок
4. **Тесты**: Написать unit-тесты для каждого пакета

## Важные замечания

- Оригинальный `main.go` сохранен как `main_old.go`
- Некоторые сложные функции (выплаты по ставкам) упрощены и требуют доработки
- Циклические зависимости между пакетами разрешены путем рефакторинга
- Код готов к дальнейшему развитию и добавлению новых функций
