# Telegram Random Bot

Бот для игры в выбывание участников с экономической системой.

## Запуск через Docker Compose

### Требования
- Docker
- Docker Compose

### Запуск
```bash
# Клонировать репозиторий и перейти в директорию
cd /path/to/project

# Запустить сервисы
docker-compose up -d

# Просмотреть логи
docker-compose logs -f app
```

### Остановка
```bash
# Остановить сервисы
docker-compose down

# Остановить и удалить volumes (данные Redis будут потеряны)
docker-compose down -v
```

### Локальный запуск (для разработки)
```bash
# Установить зависимости
go mod tidy

# Запустить Redis локально
redis-server

# Запустить приложение
go run main.go

# Или скомпилировать и запустить
go build -o tg-random-bot main.go
./tg-random-bot
```

### Остановка локального процесса
```bash
# Остановить локальный процесс бота
pkill -f tg-random-bot
```

## Архитектура

### Сервисы
- **Redis**: База данных для хранения балансов участников
- **App**: Telegram бот с игровой логикой

### Сеть
- Оба сервиса работают в изолированной Docker сети `tg-random-network`
- Redis доступен приложению по имени `redis:6379`

## Переменные окружения

### Для приложения
- `REDIS_ADDR`: Адрес Redis сервера (по умолчанию `localhost:6379`)

## Команды бота

### Основные команды
- `/start` - Начать игру
- `/game` - Интерактивная автоматическая игра:
  - Каждые 5 секунд показывает результат раунда
  - Отображает номер раунда (X/Y) и живой таймер
  - Всё обновляется в одном сообщении
- `/stopgame` - Остановить текущую игру (только админы)
- `/reset` - Сбросить игру
- `/list` - Список участников

### Экономика
- `/balance` - Проверить баланс
- `/givefunds @username сумма` - Дать деньги (только админы)
- `/withdrawfunds @username сумма` - Снять деньги (только админы)

### Администрирование
- `/add имя фамилия username` - Добавить участника
- `/remove имя фамилия` - Удалить участника
- `/setprize текст` - Изменить приз
- `/promote ID` - Повысить до администратора

## Makefile команды

Проект включает Makefile для удобного управления:

```bash
make up          # Запустить Docker сервисы
make down        # Остановить Docker сервисы + локальный процесс бота
make restart     # Перезапустить сервисы
make rebuild     # Пересобрать и перезапустить сервисы
make stop-local  # Остановить только локальный процесс бота
```

## Разработка

### Локальный запуск
```bash
# Установить зависимости
go mod tidy

# Запустить Redis локально
redis-server

# Запустить приложение
go run main.go
```

### Сборка Docker образа
```bash
docker build -t tg-random-bot .
```
